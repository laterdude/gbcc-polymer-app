<link rel="import" href="../../../polymer/polymer.html">
<link rel="import" href="../../../paper-styles/paper-styles.html">
<link rel="import" href="../../neon-shared-element-animatable-behavior.html">
<link rel="import" href="../../neon-animatable-behavior.html">
<link rel="import" href="../../neon-animation-runner-behavior.html">

<link rel="import" type="css" href="../shared.css">
<!--delete this import once element is refactored-->

<dom-module id="animated-grid-dec">
 
  <template>

  <style>
  
    :host {
      display: block;
      padding-top: .25em;
      margin-left: -.5em;
      margin-right: -.5em;
      /*background: #4D4D4D;*/
      visibility: hidden;
      height: 100%;
    }

    :host::content div.tile {
      display: inline-block;
      float: left;
      color: black;
      vertical-align: top;
      margin: .25em;
      width: calc(100% / 6 - .5em);
      height: calc(100% / 3 - .5em);
     /* width: calc(100% / 3);
      height: calc(100% / 2);*/

      @apply(--paper-font-title);
      @apply(--layout-vertical);
      @apply(--layout-center-center);
    }
    :host::content div.tile:nth-of-type(1) {
      width: calc(100% / 3 - .5em);
      height: calc(100% / 3 * 2 - .5em);
    } 
    :host::content div.tile:nth-of-type(4) {
      width: calc(100% / 3 - .5em);
    } 
    :host::content div.tile:nth-of-type(5) {
      width: calc(100% / 3 - .5em);
      height: calc(100% / 3 * 2 - .5em);
    } 
    :host::content div.tile:nth-of-type(8) {
      width: calc(100% / 3 - .5em);
      height: calc(100% / 3 - .5em);
    } 
    :host::content div.tile:nth-of-type(9) {
      position: absolute;
      margin-top: .25em;
      margin-left: .25em;
      margin-right: .25em;
      top: calc(100% / 3 * 2 + 0em);
      width: calc(100% / 6 - .5em);
      height: calc(100% / 3 - .5em);
    } 
    :host::content div.tile:nth-of-type(10) {
      position: absolute;
      margin-top: .25em;
      margin-bottom: 0em;
      margin-left: .75em;
      margin-right: 0em;
      top: calc(100% / 3 * 2 + 0em);
      left: calc(100% / 6 - .5em);
      width: calc(100% / 6 - .5em);
      height: calc(100% / 3 - .5em);
    }
    :host::content div button { border: none; display: block; }
     
    :host::content div button.metal {
      position: relative;
      margin: 40px auto;
      outline: none;
      
      font: bold 6em/2em "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;
      text-align: center;
      color: hsla(0,0%,20%,1);
      text-shadow: hsla(0,0%,40%,.5) 0 -1px 0, hsla(0,0%,100%,.6) 0 2px 1px;
      
      background-color: hsl(0,0%,90%);
      box-shadow: inset hsla(0,0%,15%,  1) 0  0px 0px 4px, /* border */
        inset hsla(0,0%,15%, .8) 0 -1px 5px 4px, /* soft SD */
        inset hsla(0,0%,0%, .25) 0 -1px 0px 7px, /* bottom SD */
        inset hsla(0,0%,100%,.7) 0  2px 1px 7px, /* top HL */
        
        hsla(0,0%, 0%,.15) 0 -5px 6px 4px, /* outer SD */
        hsla(0,0%,100%,.5) 0  5px 6px 4px; /* outer HL */ 
      
      transition: color .4s;
    }
    :host::content div button.radial.metal {
      width: 160px;
      height: 160px;
      line-height: 160px;
      border-radius: 80px;
      background-image: -webkit-radial-gradient(  50%   0%,  8% 50%, hsla(0,0%,100%,.5) 0%, hsla(0,0%,100%,0) 100%),
        -webkit-radial-gradient(  50% 100%, 12% 50%, hsla(0,0%,100%,.6) 0%, hsla(0,0%,100%,0) 100%),
        -webkit-radial-gradient(   0%  50%, 50%  7%, hsla(0,0%,100%,.5) 0%, hsla(0,0%,100%,0) 100%),
        -webkit-radial-gradient( 100%  50%, 50%  5%, hsla(0,0%,100%,.5) 0%, hsla(0,0%,100%,0) 100%),
        
        -webkit-repeating-radial-gradient( 50% 50%, 100% 100%, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   3%, hsla(0,0%,  0%,.1) 3.5%),
        -webkit-repeating-radial-gradient( 50% 50%, 100% 100%, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%,.1) 7.5%),
        -webkit-repeating-radial-gradient( 50% 50%, 100% 100%, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.2) 2.2%),
        
        -webkit-radial-gradient( 50% 50%, 200% 50%, hsla(0,0%,90%,1) 5%, hsla(0,0%,85%,1) 30%, hsla(0,0%,60%,1) 100%);
    }
    :host::content div button.radial.metal:before {
      content: "";
      top: 0;
      left: 0;
      position: absolute;
      width: inherit;
      height: inherit;
      border-radius: inherit;
      
      /* fake conical gradients */
      background-image: -webkit-radial-gradient(  50%   0%, 10% 50%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%),
        -webkit-radial-gradient(  50% 100%, 10% 50%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%),
        -webkit-radial-gradient(   0%  50%, 50% 10%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%),
        -webkit-radial-gradient( 100%  50%, 50% 06%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%);
    }
    :host::content div button.metal.radial:after {
      content: "";
      top: 0;
      left: 0;
      position: absolute;
      width: inherit;
      height: inherit;
      border-radius: inherit;
      
      /* fake conical gradients */
      background-image: -webkit-radial-gradient(  50%   0%, 10% 50%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%),
        -webkit-radial-gradient(  50% 100%, 10% 50%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%),
        -webkit-radial-gradient(   0%  50%, 50% 10%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%),
        -webkit-radial-gradient( 100%  50%, 50% 06%, hsla(0,0%,0%,.1) 0%, hsla(0,0%,0%,0) 100%);
    }
    :host::content div button.metal.radial:before { transform: rotate( 65deg); }
    :host::content div button.metal.radial:after { transform: rotate(-65deg); }
    :host::content div button.metal.linear {
      width: 100px;
      font-size: 4em;
      height: 80px;
      border-radius: .5em;
      background-image: -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0)   6%, hsla(0,0%,100%, .1) 7.5%),
        -webkit-repeating-linear-gradient(left, hsla(0,0%,  0%,0) 0%, hsla(0,0%,  0%,0)   4%, hsla(0,0%,  0%,.03) 4.5%),
        -webkit-repeating-linear-gradient(left, hsla(0,0%,100%,0) 0%, hsla(0,0%,100%,0) 1.2%, hsla(0,0%,100%,.15) 2.2%),
    
      linear-gradient(180deg, hsl(0,0%,78%)  0%, 
      hsl(0,0%,90%) 47%, 
      hsl(0,0%,78%) 53%,
      hsl(0,0%,70%)100%);
    }

    :host::content div button.metal.linear.oval {
      margin-top: 100px;
      width: 70px;
      height: 60px;
      line-height: 60px !important;
      border-radius: 50%;
      font: italic bold 3em/50px Georgia, "Times New Roman", Times, serif;
    }
    :host::content div button.metal:active {
      color: hsl(210, 100%, 40%);
      text-shadow: hsla(210,100%,20%,.3) 0 -1px 0, hsl(210,100%,85%) 0 2px 1px, hsla(200,100%,80%,1) 0 0 5px, hsla(210,100%,50%,.6) 0 0 20px;
      box-shadow: 
        inset hsla(210,100%,30%,  1) 0  0px 0px 4px, /* border */
        inset hsla(210,100%,15%, .4) 0 -1px 5px 4px, /* soft SD */
        inset hsla(210,100%,20%,.25) 0 -1px 0px 7px, /* bottom SD */
        inset hsla(210,100%,100%,.7) 0  2px 1px 7px, /* top HL */
        
        hsla(210,100%,75%, .8) 0  0px 3px 2px, /* outer SD */
        hsla(210,50%,40%, .25) 0 -5px 6px 4px, /* outer SD */
        hsla(210,80%,95%,   1) 0  5px 6px 4px; /* outer HL */
      }
  

    :host::content div a {
      display:block;
      /*@apply(--shadow-elevation-2dp);*/
      position:relative;
      text-decoration: none;
    }

    @media (max-width: 899px) {
    :host {
      padding-top: .125em;
    } 

    :host::content div.tile {
      display: inline-block;
      float: left;
      color: black;
      vertical-align: top;
      margin: .125em;
      width: calc(100% / 2 - .25em);
      height: 220px;
     
      @apply(--paper-font-title);
      @apply(--layout-vertical);
      @apply(--layout-center-center);
    }
    :host::content div.tile:nth-of-type(1) {
      width: calc(100% / 2 - .25em);
      height: 220px;
    } 
    :host::content div.tile:nth-of-type(4) {
      width: calc(100% / 2 - .25em);
      height: 220px;
    } 
    :host::content div.tile:nth-of-type(5) {
      width: calc(100% / 2 - .25em);
      height: 220px;
    } 
    :host::content div.tile:nth-of-type(8) {
      width: calc(100% / 2 - .25em);
      height: 220px;
    } 
    :host::content div.tile:nth-of-type(9) {
      position: relative;
      top: 0;
      left: 0;
      width: calc(100% / 2 - .25em);
      height: 220px;
    } 
    :host::content div.tile:nth-of-type(10) {
      position: static;
      top: calc(100% / 3 * 2);
      left: calc(100% / 6);
      width: calc(100% / 2 - .25em);
      height: 220px;
    } 
    
    /*:host::content div:hover {
      @apply(--shadow-elevation-2dp);
      position:relative;
    }*/


    }

    #placeholder {
      opacity: 0;
      background-color: grey;
    }

    #container {
      height: 100%;
    }

  </style>
  
    <div id="placeholder" class="fit"></div>

    <div id="container">
        <!-- <content id='content' select="div"></content> -->
        <content id='content' select=".tile"></content>
    </div>
    <!-- <content id='content' ></content> -->
  </template>

</dom-module>

<script>

  Polymer({

    is: 'animated-grid-dec',

    behaviors: [
      Polymer.NeonSharedElementAnimatableBehavior,
      Polymer.NeonAnimatableBehavior,
      Polymer.NeonAnimationRunnerBehavior
    ],

    properties: {

      animationConfig: {
        type: Object,
        value: function() {
          return {
            'entry': [{
              name: 'cascaded-animation',
              animation: 'transform-animation',
              transformFrom: 'translateY(100%)',
              transformTo: 'none',
              timing: {
                delay: 50
              }
            },
            {
              name: 'reverse-ripple-animation',
              id: 'reverse-ripple',
              toPage: this
            }],
            'exit': [{
              name: 'fade-out-animation',
              node: this.$.container,
              timing: {
                delay: 150,
                duration: 0
              }
            },


            {
              name: 'ripple-animation',
              id: 'ripple',
              fromPage: this
            } 
            // ,{
            //   name: 'hero-animation',
            //   id: 'hero',
            //   fromPage: this
            // }
            ]
          }
        }
      }

    },

    attached: function() {
      this.async(function() {
        var nodeList = Polymer.dom(this.$.content).getDistributedNodes();
        // I only want to animate divs ()
        var divNodes = nodeList.filter(function(node){
          return (node.nodeName === "DIV");
        });
        this.animationConfig.entry[0].nodes = divNodes;
        // this.animationConfig.exit[1].fromPage = divNodes;
        // this.animationConfig.entry[0].nodes = divNodes;
      });
    },

    // listeners: {
    //   click: '_onClick'
    // },

    // _computeTileClass: function(color) {
    //   return 'background-color: ' + color + '';
    // },
    // _computeTileClass: function(color) {
    //   return 'tile ' + color + '';
    // },

    show: function() {
    this.style.visibility = 'visible';
    this.playAnimation('entry');
    },

  // _onClick: function(event) {
  //     var target = event.target;
  //     while (target !== this) {
  //       target = target.parentNode;
  //     }

  //     // configure the page animation
  //     this.sharedElements = {
  //       'hero': target,
  //       'ripple': target
  //     };
  //     this.animationConfig['exit'][0].gesture = {
  //       x: event.x || event.pageX,
  //       y: event.y || event.pageY
  //     };

  //     this.fire('tile-click', {
  //       tile: target,
  //       data: target.item
  //     });
  // }
});

</script>

<!-- So i've been playing around with the neon element examples. Specifically the load example.

I'm able to accomplish what I want but I feel there should be a more elegant way to do it. The way the example loads content is by creating an array inside of a config object and then uses a dom-repeat to stamp them out all from within animated-grid.html

This seems to force very tight coupling between the animations and the content that is being animated. I don't want to encapsulate content in side of my grid I basically want to say Hey I want an animated grid here are the cells/content to be put inside of it and then having the animated grid take care of laying out and animating those children

I set out to create an API that was more declarative like this.

<animated-grid id="grid">
  <div style="background-color: #9C27B0"> <span>1</span> </div>
  <div style="background-color: #4CAF50"> <span>2</span> </div>
  <div style="background-color: #2196F3"> <span>3</span> </div>
  <div style="background-color: #673AB7"> <span>4</span> </div>
  <div style="background-color: #FF9800"> <span>5</span> </div>
  <div style="background-color: #049688"> <span>6</span> </div>
</animated-grid>
I figured I could change the css selectors from .tile to :host::content div.

Then the template to

  <template>
    <content id='content'></content>
  </template>
I then took a stab at rewriting the attached method to get the children in the lightdom instead of queryselecting for .tile

attached: function() {
  this.async(function() {
    var nodeList = Polymer.dom(this.$.content).getDistributedNodes();
    // I only want to animate divs
    nodelist = nodeList.filter(function(node){
      return (node.nodeName === "DIV");
    });
    this.animationConfig['entry'][0].nodes = nodeList;
  });
},

However, I keep getting a nasty error in my console.


A good friend pointed out that while JavaScript is still insane, it's insane for different reasons than erroneously listed here. The error was that the variable being assigned into, nodelist, from the filter, did not have a capital "L", like the var nodeList does. In JS, this means nodelist is now in the global variable object,  global.nodelist, which is why nodeList seemingly wasn't filtered or assigned correctly into. So, another solution is to simply capitalize nodelist to nodeList in the filter return, and it should be fine.

Everything you're doing is fine and good (the async in attached is the right way to setup your animationConfig), with the exception of one thing.

The error you're getting is because you're attempting to animate text nodes with the cascade-animation you setup.

You're attempting to animate text nodes because your variable nodeList contains all the original 13 light dom children, which includes the text nodes, instead of just divs.

The reason your filtered array wasn't filtered, is because JavaScript is insane, and assigning into the array doesn't work as expected, like in every other language.

A solution is to use a new variable for the filter results:

var divNodes = nodeList.filter(function(node){
  return (node.nodeName === 'DIV');
});
this.animationConfig.entry[0].nodes = divNodes; -->